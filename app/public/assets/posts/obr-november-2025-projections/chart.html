<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 10px;
            background: white;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        .controls label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }
        .controls select {
            padding: 8px 12px;
            border: 2px solid #319795;
            background: white;
            color: #374151;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 14px;
            font-weight: 500;
            min-width: 200px;
        }
        .controls select:focus {
            outline: none;
            border-color: #2C7A7B;
        }
        #chart {
            width: 100%;
            height: 350px;
        }
        #usage {
            margin-top: 10px;
            padding: 12px 16px;
            background: #F9FAFB;
            border-radius: 6px;
            font-size: 13px;
            color: #4B5563;
            line-height: 1.5;
        }
        #usage strong {
            color: #374151;
        }
        #usage .example {
            color: #319795;
            font-weight: 500;
        }
        #usage .count {
            color: #6B7280;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="metric-select">Select metric:</label>
        <select id="metric-select" onchange="showChart(this.value)">
            <optgroup label="Inflation">
                <option value="cpi" selected>CPI inflation</option>
                <option value="rpi">RPI inflation</option>
                <option value="cpih">CPIH inflation</option>
            </optgroup>
            <optgroup label="Labour market">
                <option value="earnings">Average earnings</option>
            </optgroup>
            <optgroup label="Housing">
                <option value="house_prices">House prices</option>
                <option value="rent">Rent (private & social)</option>
                <option value="social_rent">Social rent</option>
                <option value="mortgage_interest">Mortgage interest</option>
            </optgroup>
            <optgroup label="Income">
                <option value="non_labour_income">Non-labour income</option>
                <option value="per_capita_gdp">Per capita GDP</option>
                <option value="per_capita_mixed">Per capita mixed income</option>
                <option value="per_capita_nli">Per capita non-labour income</option>
            </optgroup>
            <optgroup label="Local taxes">
                <option value="council_tax_england">Council tax (England)</option>
                <option value="council_tax_scotland">Council tax (Scotland)</option>
                <option value="council_tax_wales">Council tax (Wales)</option>
            </optgroup>
        </select>
    </div>
    <div id="chart"></div>
    <div id="usage"></div>

    <script>
        const years = [2025, 2026, 2027, 2028, 2029, 2030];

        // March 2025 forecast values from OBR EFO March 2025 detailed forecast tables
        // (corrected in policyengine-uk PR #1393)
        // November 2025 forecast values from OBR EFO November 2025 detailed forecast tables
        const data = {
            cpi: {
                march: [3.21, 2.08, 1.99, 2.00, 2.00, 2.00],
                november: [3.45, 2.48, 2.02, 2.04, 2.04, 2.00],
                title: 'CPI inflation (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Universal Credit, PIP, Child Benefit, State Pension</span> <span class="count">and 44 other benefits and consumption variables</span>. Also used for absolute poverty thresholds, triple lock calculations, and real-terms analysis.'
            },
            rpi: {
                march: [4.09, 3.23, 3.04, 2.85, 2.84, 2.38],
                november: [4.33, 3.71, 3.13, 2.87, 2.91, 2.31],
                title: 'RPI inflation (%)',
                usage: '<strong>Used in PolicyEngine for:</strong> <span class="example">Private pension uprating</span> and fuel duty projections. RPI remains important for student loan interest rates and some legacy pension schemes.'
            },
            cpih: {
                march: [3.88, 2.50, 2.13, 2.05, 2.08, 2.24],
                november: [4.14, 3.00, 2.24, 2.10, 2.15, 2.19],
                title: 'CPIH inflation (%)',
                usage: '<strong>Used in PolicyEngine for:</strong> <span class="example">After-housing-costs (AHC) deflator</span> calculations. CPIH includes owner occupiers\' housing costs, making it useful for real-terms comparisons that account for housing.'
            },
            earnings: {
                march: [4.32, 2.30, 2.06, 2.18, 2.48, 2.92],
                november: [5.17, 3.33, 2.25, 2.10, 2.21, 2.32],
                title: 'Average earnings growth (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Employment income, pension contributions, student loan repayments</span> <span class="count">(6 variables)</span>. Also used in triple lock calculations for State Pension.'
            },
            house_prices: {
                march: [2.81, 2.47, 2.56, 2.48, 2.43, null],
                november: [3.84, 1.20, 1.72, 2.09, 2.54, 2.96],
                title: 'House price growth (%)',
                usage: '<strong>Used in PolicyEngine for:</strong> Stamp duty projections and property value calculations. Not currently used for direct variable uprating.'
            },
            rent: {
                march: [6.49, 3.89, 2.98, 2.27, 2.38, null],
                november: [6.34, 4.78, 3.46, 2.70, 2.51, 2.48],
                title: 'Rent growth (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Private rent</span> for households in the private rented sector. Combined with social rent to derive private-sector-specific growth rates.'
            },
            social_rent: {
                march: [3.5, 4.3, 3.1, 3.0, 3.0, null],
                november: [3.5, 4.5, 3.5, 3.0, 3.0, 3.0],
                title: 'Social rent growth (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Social housing rent</span> for households in council or housing association properties. Derived from CPI+1% with one-year lag.'
            },
            mortgage_interest: {
                march: [6.91, 4.17, 2.44, 1.95, 2.08, null],
                november: [6.19, 2.63, 1.92, 1.85, 2.02, 2.35],
                title: 'Mortgage interest growth (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Mortgage interest repayments</span>. Affects housing cost projections for owner-occupiers with mortgages.'
            },
            non_labour_income: {
                march: [6.45, 6.34, 4.76, 3.54, 3.56, null],
                november: [5.19, 5.65, 4.74, 3.64, 3.02, 2.92],
                title: 'Non-labour income growth (%)',
                usage: '<strong>Source parameter:</strong> Used to derive per capita non-labour income growth by subtracting population growth. Not directly used for uprating.'
            },
            per_capita_gdp: {
                march: [3.5, 3.5, 3.7, 3.7, 3.7, null],
                november: [4.18, 3.27, 3.26, 3.02, 2.94, 3.06],
                title: 'Per capita GDP growth (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Dividend income, savings interest, property income, capital gains, wealth</span> <span class="count">and 16 other income and wealth variables</span>.'
            },
            per_capita_mixed: {
                march: [5.9, 3.6, 3.5, 3.5, 3.8, null],
                november: [0.24, 3.62, 3.74, 3.51, 3.58, 3.64],
                title: 'Per capita mixed income growth (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Self-employment income</span>. Mixed income combines wages and profits for the self-employed.'
            },
            per_capita_nli: {
                march: [5.7, 6.0, 4.4, 3.1, 3.1, null],
                november: [4.47, 5.27, 4.37, 3.24, 2.58, 2.47],
                title: 'Per capita non-labour income growth (%)',
                usage: '<strong>Source parameter:</strong> Tracked for reference but not currently used directly for uprating. Per capita GDP growth is used instead for most non-labour income sources.'
            },
            council_tax_england: {
                march: [5.57, 5.35, 5.49, 5.43, 5.39, null],
                november: [7.81, 5.30, 5.79, 5.65, 5.47, 5.42],
                title: 'Council tax growth - England (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Council tax</span> for households in England. Based on OBR\'s forecast of local authority council tax receipts.'
            },
            council_tax_scotland: {
                march: [3.51, 3.51, 3.51, 3.51, 3.51, null],
                november: [3.84, 3.84, 3.84, 3.84, 3.84, 3.84],
                title: 'Council tax growth - Scotland (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Council tax</span> for households in Scotland. Based on OBR\'s forecast of Scottish local authority council tax receipts.'
            },
            council_tax_wales: {
                march: [4.63, 4.63, 4.63, 4.63, 4.63, null],
                november: [5.81, 5.81, 5.81, 5.81, 5.81, 5.81],
                title: 'Council tax growth - Wales (%)',
                usage: '<strong>Used in PolicyEngine to uprate:</strong> <span class="example">Council tax</span> for households in Wales. Based on OBR\'s forecast of Welsh local authority council tax receipts.'
            }
        };

        function showChart(metric) {
            const d = data[metric];

            // Filter out null values for March (which only goes to 2029)
            const marchYears = [];
            const marchValues = [];
            for (let i = 0; i < years.length; i++) {
                if (d.march[i] !== null) {
                    marchYears.push(years[i]);
                    marchValues.push(d.march[i]);
                }
            }

            const trace1 = {
                x: marchYears,
                y: marchValues,
                name: 'March 2025',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#9CA3AF', width: 2, dash: 'dash' },
                marker: { size: 8 }
            };

            const trace2 = {
                x: years,
                y: d.november,
                name: 'November 2025',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#319795', width: 3 },
                marker: { size: 10 }
            };

            const layout = {
                title: {
                    text: d.title,
                    font: {
                        size: 18,
                        color: '#374151',
                        family: 'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
                    }
                },
                xaxis: {
                    tickmode: 'array',
                    tickvals: years,
                    ticktext: years.map(String),
                    gridcolor: '#E5E7EB',
                    tickfont: {
                        family: 'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        color: '#6B7280'
                    }
                },
                yaxis: {
                    gridcolor: '#E5E7EB',
                    zeroline: true,
                    zerolinecolor: '#9CA3AF',
                    tickfont: {
                        family: 'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        color: '#6B7280'
                    },
                    ticksuffix: '%'
                },
                legend: {
                    orientation: 'h',
                    y: -0.15,
                    x: 0.5,
                    xanchor: 'center',
                    font: {
                        family: 'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        color: '#374151'
                    }
                },
                margin: { t: 50, b: 80, l: 50, r: 30 },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                hovermode: 'x unified',
                hoverlabel: {
                    font: {
                        family: 'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
                    }
                }
            };

            const config = {
                responsive: true,
                displayModeBar: false
            };

            Plotly.newPlot('chart', [trace1, trace2], layout, config);

            // Update usage text
            document.getElementById('usage').innerHTML = d.usage;
        }

        // Initial chart
        showChart('cpi');
    </script>
</body>
</html>
