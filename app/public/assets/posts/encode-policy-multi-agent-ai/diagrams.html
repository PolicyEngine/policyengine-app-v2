<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encode Policy Workflow Diagrams</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600;8..60,700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light Blueprint Palette */
            --bg-diagram: #f9f8f6;
            --bg-card: #ffffff;
            --grid-color: rgba(13, 115, 119, 0.08);
            --accent: #0d7377;
            --accent-light: rgba(13, 115, 119, 0.1);
            --accent-mid: rgba(13, 115, 119, 0.2);
            --text-dark: #1e3a3a;
            --text-mid: #4a6363;
            --text-light: #7a9494;
            --border: #d4dede;
            --border-accent: rgba(13, 115, 119, 0.4);
            --warning: #b45309;
            --warning-bg: rgba(180, 83, 9, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Serif 4', Georgia, serif;
            line-height: 1.8;
            color: #2d3748;
            background: transparent;
            padding: 10px;
        }

        /* Diagram tabs */
        .diagram-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .diagram-tab {
            padding: 10px 20px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-mid);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .diagram-tab:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .diagram-tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .diagram-panel {
            display: none;
        }

        .diagram-panel.active {
            display: block;
        }

        .diagram-hint {
            font-size: 0.95rem;
            color: var(--text-mid);
            margin-bottom: 15px;
        }

        /* ══════════════════════════════════════════════════════════════
           INTERACTIVE WORKFLOW DIAGRAM - Light Blueprint Aesthetic
           ══════════════════════════════════════════════════════════════ */

        .workflow-diagram {
            background: var(--bg-diagram);
            background-image:
                radial-gradient(circle, var(--grid-color) 1px, transparent 1px);
            background-size: 20px 20px;
            border-radius: 8px;
            padding: 50px 35px 40px;
            margin: 0 0 20px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.03);
        }

        .workflow-diagram::before {
            content: 'WORKFLOW';
            position: absolute;
            top: 18px;
            left: 22px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            font-weight: 600;
            letter-spacing: 0.2em;
            color: var(--text-light);
            text-transform: uppercase;
        }

        .workflow-diagram::after {
            content: '';
            position: absolute;
            top: 18px;
            right: 22px;
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            animation: pulse 2.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.85); }
        }

        .orchestrator-box {
            background: var(--bg-card);
            border: 2px solid var(--accent);
            border-radius: 8px;
            padding: 20px 40px;
            text-align: center;
            max-width: 200px;
            margin: 0 auto 30px;
            position: relative;
            box-shadow: 0 4px 20px rgba(13, 115, 119, 0.08);
        }

        .orchestrator-box .title {
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .orchestrator-box .cmd {
            color: var(--text-dark);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .connection-line {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 40px;
            position: relative;
        }

        .connection-line::before {
            content: '';
            position: absolute;
            width: 2px;
            height: 100%;
            background: var(--accent);
        }

        .connection-line::after {
            content: '';
            position: absolute;
            bottom: 0;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 7px solid var(--accent);
        }

        .phases-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .phase-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 16px 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
            position: relative;
        }

        .phase-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: transparent;
            border-radius: 6px 6px 0 0;
            transition: background 0.2s;
        }

        .phase-box:hover {
            border-color: var(--border-accent);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(13, 115, 119, 0.1);
        }

        .phase-box:hover::before {
            background: var(--accent);
        }

        .phase-box.active {
            border-color: var(--accent);
            background: var(--bg-card);
            box-shadow: 0 4px 25px rgba(13, 115, 119, 0.12);
        }

        .phase-box.active::before {
            background: var(--accent);
        }

        .phase-box .phase-num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--text-light);
            letter-spacing: 0.05em;
            margin-bottom: 5px;
            transition: color 0.2s;
        }

        .phase-box:hover .phase-num,
        .phase-box.active .phase-num {
            color: var(--accent);
        }

        .phase-box .phase-title {
            color: var(--text-dark);
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .phase-connector {
            color: var(--text-light);
            font-size: 1rem;
            padding: 0 2px;
        }

        .click-hint {
            text-align: center;
            color: var(--text-light);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.68rem;
            letter-spacing: 0.03em;
            margin-top: 22px;
            transition: opacity 0.3s;
        }

        /* Phase Detail Panels */
        .phase-details {
            margin-top: 22px;
        }

        .phase-detail {
            display: none;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
            border-radius: 0 6px 6px 0;
            padding: 24px 28px;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        .phase-detail.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .phase-detail h4 {
            color: var(--text-dark);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .phase-detail p {
            color: var(--text-mid);
            font-family: 'Source Serif 4', Georgia, serif;
            font-size: 0.95rem;
            margin-bottom: 14px;
            line-height: 1.7;
        }

        .phase-detail ul {
            color: var(--text-mid);
            padding-left: 18px;
            margin-bottom: 16px;
        }

        .phase-detail li {
            font-family: 'Source Serif 4', Georgia, serif;
            font-size: 0.92rem;
            margin-bottom: 8px;
            line-height: 1.6;
            color: var(--text-mid);
        }

        .phase-detail li::marker {
            color: var(--accent);
        }

        .phase-detail code {
            background: var(--accent-light);
            color: var(--accent);
            border: none;
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        .phase-detail strong {
            color: var(--text-dark);
            font-weight: 600;
        }

        .agent-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .agent-tag {
            display: inline-flex;
            align-items: center;
            background: var(--accent-light);
            border: 1px solid var(--accent-mid);
            color: var(--accent);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
        }

        .agent-tag::before {
            content: '>';
            margin-right: 5px;
            opacity: 0.7;
        }

        .quality-gate-inline {
            background: var(--warning-bg);
            border: 1px solid rgba(180, 83, 9, 0.2);
            border-left: 3px solid var(--warning);
            padding: 12px 16px;
            margin: 16px 0;
            border-radius: 0 5px 5px 0;
        }

        .quality-gate-inline p {
            margin: 0;
            color: #92400e;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.78rem;
            line-height: 1.6;
        }

        .quality-gate-inline strong {
            color: var(--warning);
        }

        /* ══════════════════════════════════════════════════════════════
           AGENT FLOW DIAGRAM
           ══════════════════════════════════════════════════════════════ */

        .agent-flow-container {
            background: var(--bg-diagram);
            background-image:
                radial-gradient(circle, var(--grid-color) 1px, transparent 1px);
            background-size: 20px 20px;
            border-radius: 8px;
            padding: 40px 20px;
            margin: 0;
            position: relative;
            border: 1px solid var(--border);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.03);
            overflow-x: auto;
        }

        .agent-flow-container::before {
            content: 'AGENT FLOW';
            position: absolute;
            top: 14px;
            left: 18px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            font-weight: 600;
            letter-spacing: 0.2em;
            color: var(--text-light);
            text-transform: uppercase;
        }

        .agent-flow-svg {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
        }

        .agent-flow-svg .network-line {
            stroke: var(--text-mid);
            stroke-width: 2;
            stroke-dasharray: 6 4;
            fill: none;
        }

        .agent-flow-svg .network-line.thick {
            stroke-width: 2.5;
        }

        .agent-flow-svg .network-node {
            fill: var(--bg-card);
            stroke: var(--accent);
            stroke-width: 2;
        }

        .agent-flow-svg .network-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            fill: var(--text-mid);
            text-anchor: middle;
        }

        .agent-flow-svg .svg-icon {
            color: var(--text-mid);
            pointer-events: none;
        }

        .agent-flow-svg .loop-indicator {
            fill: rgba(13, 115, 119, 0.03);
            stroke: var(--accent);
            stroke-width: 2.5;
            stroke-dasharray: 12 6;
            opacity: 0.7;
            animation: rotateLoop 6s linear infinite;
        }

        @keyframes rotateLoop {
            from { stroke-dashoffset: 0; }
            to { stroke-dashoffset: -72; }
        }

        .agent-flow-svg .loop-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 600;
            font-style: italic;
            fill: #1a202c;
            text-anchor: middle;
            letter-spacing: 0.03em;
        }

        @media (max-width: 768px) {
            .workflow-diagram {
                padding: 45px 20px 35px;
            }
            .phases-container {
                flex-direction: column;
                gap: 12px;
            }
            .phase-connector {
                transform: rotate(90deg);
            }
            .phase-box {
                width: 100%;
                max-width: 180px;
            }
        }
    </style>
</head>
<body>
    <!-- Tab buttons -->
    <div class="diagram-tabs">
        <button class="diagram-tab active" onclick="showDiagramTab('workflow')">Workflow phases</button>
        <button class="diagram-tab" onclick="showDiagramTab('agentflow')">Agent flow</button>
    </div>

    <!-- Workflow Diagram Tab -->
    <div class="diagram-panel active" id="panel-workflow">
    <p class="diagram-hint">Click each phase below to explore:</p>
    <!-- Interactive Workflow Diagram -->
    <div class="workflow-diagram">
        <div class="orchestrator-box">
            <div class="title">Orchestrator</div>
            <div class="cmd">encode-policy</div>
        </div>

        <div class="connection-line"></div>

        <div class="phases-container">
            <div class="phase-box" data-phase="setup" onclick="showPhase('setup')">
                <div class="phase-num">PHASE 1</div>
                <div class="phase-title">Setup</div>
            </div>
            <span class="phase-connector">-></span>
            <div class="phase-box" data-phase="development" onclick="showPhase('development')">
                <div class="phase-num">PHASE 2</div>
                <div class="phase-title">Development</div>
            </div>
            <span class="phase-connector">-></span>
            <div class="phase-box" data-phase="validation" onclick="showPhase('validation')">
                <div class="phase-num">PHASE 3</div>
                <div class="phase-title">Validation</div>
            </div>
            <span class="phase-connector">-></span>
            <div class="phase-box" data-phase="complete" onclick="showPhase('complete')">
                <div class="phase-num">PHASE 4</div>
                <div class="phase-title">Review</div>
            </div>
        </div>

        <p class="click-hint">Select a phase to inspect</p>

        <div class="phase-details">
            <!-- Phase 1: Setup -->
            <div class="phase-detail" id="phase-setup">
                <h4>Phase 1: Setup (Step 1)</h4>
                <div class="agent-tags">
                    <span class="agent-tag">issue-manager</span>
                </div>
                <p>The workflow begins by establishing coordination points:</p>
                <ul>
                    <li>Searches GitHub for existing issues to avoid duplicates</li>
                    <li>Creates a new issue with a status template if none exists</li>
                    <li>Creates a branch (<code>or-tanf</code>, <code>ia-tanf</code>)</li>
                    <li>Opens a draft PR to the upstream repository</li>
                </ul>
                <p>Every subsequent agent references this issue and PR for coordination.</p>
            </div>

            <!-- Phase 2: Development -->
            <div class="phase-detail" id="phase-development">
                <h4>Phase 2: Development (Steps 2-3)</h4>
                <div class="agent-tags">
                    <span class="agent-tag">document-collector</span>
                    <span class="agent-tag">parameter-architect</span>
                    <span class="agent-tag">test-creator</span>
                    <span class="agent-tag">rules-engineer</span>
                    <span class="agent-tag">edge-case-generator</span>
                </div>

                <p><strong>Step 2: Research</strong> - The document-collector researches official sources: statutes, policy manuals, state plans, and benefit calculators. Output: <code>sources/working_references.md</code></p>

                <div class="quality-gate-inline">
                    <p><strong>Quality gate 1:</strong> Documentation must include the official program name, income limits, eligibility criteria, and legal citations.</p>
                </div>

                <p><strong>Step 3: Build</strong> - Three parallel tracks:</p>
                <ul>
                    <li><strong>Parameters:</strong> The parameter-architect creates YAML files with legal citations</li>
                    <li><strong>Implementation:</strong> test-creator and rules-engineer work simultaneously from the same docs - neither sees the other's output</li>
                    <li><strong>Edge cases:</strong> The edge-case-generator adds boundary tests</li>
                </ul>

                <div class="quality-gate-inline">
                    <p><strong>Quality gates 2 & 3:</strong> Parameter values must match source documents. Implementation logic must match documented formulas.</p>
                </div>
            </div>

            <!-- Phase 3: Validation -->
            <div class="phase-detail" id="phase-validation">
                <h4>Phase 3: Validation (Steps 4-6)</h4>
                <div class="agent-tags">
                    <span class="agent-tag">implementation-validator</span>
                    <span class="agent-tag">reference-validator</span>
                    <span class="agent-tag">ci-fixer</span>
                    <span class="agent-tag">pr-pusher</span>
                </div>

                <p><strong>Step 4: Organization check</strong> - The validator loads 7 skills and checks naming conventions, file structure, metadata completeness, code patterns, and cross-references.</p>

                <p><strong>Step 5: Validate and fix</strong> - First, the reference-validator checks that all parameters have proper citations. Then the ci-fixer runs tests locally (2-3 min vs 20-30 min on GitHub CI), analyzes failures, and delegates to specialists:</p>
                <ul>
                    <li>Calculation errors -> <code>rules-engineer</code></li>
                    <li>Test expectation errors -> <code>test-creator</code></li>
                    <li>Parameter value errors -> <code>parameter-architect</code></li>
                </ul>
                <p>This cycle repeats until all tests pass.</p>

                <p><strong>Step 6: Format and push</strong> - The pr-pusher adds changelog, runs formatters (<code>black</code>, <code>isort</code>), and pushes.</p>
            </div>

            <!-- Phase 4: Review -->
            <div class="phase-detail" id="phase-complete">
                <h4>Phase 4: Review (Steps 7-8)</h4>
                <div class="agent-tags">
                    <span class="agent-tag">program-reviewer</span>
                </div>

                <p><strong>Step 7: Review</strong> - The program-reviewer researches regulations <em>before</em> reading code (preventing confirmation bias), then compares implementation against source documents. If discrepancies are found, findings are posted to the PR for human review.</p>

                <p><strong>Step 8: Documentation</strong> - The reviewer updates the PR description with:</p>
                <ul>
                    <li>Regulatory authority citations</li>
                    <li>Income eligibility tests with sources</li>
                    <li>Benefit calculation formulas</li>
                    <li>Files added and test coverage</li>
                </ul>
                <p>The PR remains a draft - <strong>humans make the final merge decision</strong>.</p>
            </div>
        </div>
    </div>
    </div>

    <!-- Agent Flow Diagram Tab -->
    <div class="diagram-panel" id="panel-agentflow">
    <p class="diagram-hint">The diagram shows how agents connect. The ellipse represents the iteration loop - agents cycle until tests pass.</p>
    <div class="agent-flow-container">
        <svg class="agent-flow-svg" id="agentFlowSvg" viewBox="0 0 1130 580" width="1130" height="580">
            <!-- Icon definitions -->
            <defs>
                <!-- Clipboard icon -->
                <g id="icon-clipboard">
                    <rect x="-12" y="-16" width="24" height="32" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
                    <rect x="-6" y="-20" width="12" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="2"/>
                    <line x1="-7" y1="-4" x2="7" y2="-4" stroke="currentColor" stroke-width="2"/>
                    <line x1="-7" y1="3" x2="7" y2="3" stroke="currentColor" stroke-width="2"/>
                    <line x1="-7" y1="10" x2="4" y2="10" stroke="currentColor" stroke-width="2"/>
                </g>
                <!-- Books/documents icon -->
                <g id="icon-books">
                    <rect x="-14" y="-8" width="8" height="22" rx="1" fill="none" stroke="currentColor" stroke-width="2" transform="rotate(-10)"/>
                    <rect x="-4" y="-10" width="8" height="24" rx="1" fill="none" stroke="currentColor" stroke-width="2"/>
                    <rect x="6" y="-8" width="8" height="22" rx="1" fill="none" stroke="currentColor" stroke-width="2" transform="rotate(10)"/>
                </g>
                <!-- Gear icon -->
                <g id="icon-gear">
                    <circle cx="0" cy="0" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
                    <path d="M0,-16 L3,-12 L3,-10 L-3,-10 L-3,-12 Z" fill="currentColor"/>
                    <path d="M0,16 L3,12 L3,10 L-3,10 L-3,12 Z" fill="currentColor"/>
                    <path d="M-16,0 L-12,3 L-10,3 L-10,-3 L-12,-3 Z" fill="currentColor"/>
                    <path d="M16,0 L12,3 L10,3 L10,-3 L12,-3 Z" fill="currentColor"/>
                    <path d="M-11,-11 L-9,-8 L-7,-9 L-9,-12 Z" fill="currentColor" transform="rotate(0)"/>
                    <path d="M11,-11 L9,-8 L7,-9 L9,-12 Z" fill="currentColor"/>
                    <path d="M-11,11 L-9,8 L-7,9 L-9,12 Z" fill="currentColor"/>
                    <path d="M11,11 L9,8 L7,9 L9,12 Z" fill="currentColor"/>
                </g>
                <!-- Flask/beaker icon -->
                <g id="icon-flask">
                    <path d="M-5,-16 L-5,-4 L-14,14 L14,14 L5,-4 L5,-16" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <line x1="-7" y1="-16" x2="7" y2="-16" stroke="currentColor" stroke-width="2"/>
                    <line x1="-9" y1="6" x2="9" y2="6" stroke="currentColor" stroke-width="2" stroke-dasharray="3 2"/>
                </g>
                <!-- Lambda icon -->
                <g id="icon-lambda">
                    <text x="0" y="8" font-family="Georgia, serif" font-size="40" font-weight="400" fill="currentColor" text-anchor="middle">&#955;</text>
                </g>
                <!-- Lightning bolt icon -->
                <g id="icon-lightning">
                    <polygon points="2,-16 -8,2 -1,2 -4,16 8,-2 1,-2" fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linejoin="round"/>
                </g>
                <!-- Magnifying glass icon -->
                <g id="icon-search">
                    <circle cx="-3" cy="-3" r="12" fill="none" stroke="currentColor" stroke-width="2.5"/>
                    <line x1="6" y1="6" x2="16" y2="16" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                </g>
                <!-- Chain link icon -->
                <g id="icon-link">
                    <ellipse cx="-6" cy="0" rx="8" ry="12" fill="none" stroke="currentColor" stroke-width="2.5" transform="rotate(-45)"/>
                    <ellipse cx="6" cy="0" rx="8" ry="12" fill="none" stroke="currentColor" stroke-width="2.5" transform="rotate(-45)"/>
                </g>
                <!-- Wrench icon -->
                <g id="icon-wrench">
                    <path d="M-6,-16 C-12,-10 -12,-2 -6,4 L8,18 L14,12 L0,-2 C6,-8 6,-14 0,-16 L-2,-10 L-6,-10 Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </g>
                <!-- Upload arrow icon -->
                <g id="icon-upload">
                    <line x1="0" y1="12" x2="0" y2="-8" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                    <polyline points="-8,-2 0,-12 8,-2" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="-12" y1="16" x2="12" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </g>
                <!-- Open book icon -->
                <g id="icon-book">
                    <path d="M0,-12 L0,14" stroke="currentColor" stroke-width="2"/>
                    <path d="M0,-12 C-6,-14 -12,-12 -16,-8 L-16,12 C-12,8 -6,10 0,14" fill="none" stroke="currentColor" stroke-width="2"/>
                    <path d="M0,-12 C6,-14 12,-12 16,-8 L16,12 C12,8 6,10 0,14" fill="none" stroke="currentColor" stroke-width="2"/>
                    <line x1="-12" y1="-4" x2="-4" y2="-2" stroke="currentColor" stroke-width="1.5"/>
                    <line x1="-12" y1="2" x2="-4" y2="4" stroke="currentColor" stroke-width="1.5"/>
                    <line x1="12" y1="-4" x2="4" y2="-2" stroke="currentColor" stroke-width="1.5"/>
                    <line x1="12" y1="2" x2="4" y2="4" stroke="currentColor" stroke-width="1.5"/>
                </g>
                <!-- Document icon -->
                <g id="icon-document">
                    <path d="M-10,-16 L6,-16 L14,-8 L14,16 L-10,16 Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M6,-16 L6,-8 L14,-8" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <line x1="-5" y1="0" x2="9" y2="0" stroke="currentColor" stroke-width="2"/>
                    <line x1="-5" y1="6" x2="9" y2="6" stroke="currentColor" stroke-width="2"/>
                    <line x1="-5" y1="12" x2="4" y2="12" stroke="currentColor" stroke-width="2"/>
                </g>
            </defs>

            <!-- Loop indicator - ellipse around development/validation agents -->
            <ellipse class="loop-indicator" cx="520" cy="290" rx="300" ry="250" />
            <text class="loop-label" x="520" y="555">iterate until tests pass</text>

            <!-- CONNECTIONS -->

            <!-- Entry flow: issue-manager to document-collector -->
            <line class="network-line" x1="100" y1="290" x2="118" y2="290" />

            <!-- document-collector feeds into the development loop -->
            <line class="network-line thick" x1="222" y1="260" x2="295" y2="140" />
            <line class="network-line thick" x1="222" y1="290" x2="288" y2="290" />
            <line class="network-line thick" x1="222" y1="320" x2="295" y2="440" />

            <!-- Development to edge-case-gen (after parallel work completes) -->
            <line class="network-line thick" x1="392" y1="310" x2="490" y2="360" />
            <line class="network-line thick" x1="381" y1="448" x2="490" y2="360" />

            <!-- Connections from test-creator to validators -->
            <line class="network-line thick" x1="392" y1="290" x2="640" y2="100" />
            <line class="network-line thick" x1="392" y1="290" x2="760" y2="290" />


            <!-- parameter-architect to impl-validator -->
            <line class="network-line thick" x1="392" y1="100" x2="640" y2="100" />

            <!-- parameter-architect to ci-fixer -->
            <line class="network-line thick" x1="387" y1="121" x2="760" y2="290" />

            <!-- rules-engineer to ci-fixer -->
            <line class="network-line thick" x1="392" y1="480" x2="790" y2="340" />

            <!-- parameter-architect to reference-validator -->
            <line class="network-line thick" x1="376" y1="138" x2="700" y2="475" />

            <!-- rules-engineer to reference-validator -->
            <line class="network-line thick" x1="392" y1="480" x2="700" y2="475" />

            <!-- impl-validator to ci-fixer -->
            <line class="network-line thick" x1="740" y1="140" x2="790" y2="240" />

            <!-- reference-validator to ci-fixer -->
            <line class="network-line thick" x1="700" y1="475" x2="790" y2="340" />

            <!-- edge-case-gen to ci-fixer -->
            <line class="network-line thick" x1="534" y1="360" x2="760" y2="290" />

            <!-- Main flow through ci-fixer to exit -->
            <line class="network-line" x1="880" y1="290" x2="888" y2="290" />
            <line class="network-line" x1="952" y1="290" x2="968" y2="290" />
            <line class="network-line" x1="1032" y1="290" x2="1048" y2="290" />

            <!-- NODES -->

            <!-- Entry (left) -->
            <circle class="network-node" cx="55" cy="290" r="45" />
            <g transform="translate(55,290) scale(1.4)"><use href="#icon-clipboard" class="svg-icon"/></g>
            <text class="network-label" x="55" y="355">issue-manager</text>

            <circle class="network-node" cx="170" cy="290" r="52" />
            <g transform="translate(170,282) scale(1.6)"><use href="#icon-books" class="svg-icon"/></g>
            <text class="network-label" x="170" y="362">document-</text>
            <text class="network-label" x="170" y="378">collector</text>

            <!-- Development (left side of circle) -->
            <circle class="network-node specialist" cx="340" cy="100" r="52" />
            <g transform="translate(340,100) scale(1.6)"><use href="#icon-gear" class="svg-icon"/></g>
            <text class="network-label" x="340" y="35">parameter-architect</text>

            <circle class="network-node specialist" cx="340" cy="290" r="52" />
            <g transform="translate(340,290) scale(1.6)"><use href="#icon-flask" class="svg-icon"/></g>
            <text class="network-label" x="340" y="362">test-creator</text>

            <circle class="network-node specialist" cx="340" cy="480" r="52" />
            <g transform="translate(340,488) scale(1.6)"><use href="#icon-lambda" class="svg-icon"/></g>
            <text class="network-label" x="340" y="552">rules-engineer</text>

            <circle class="network-node" cx="490" cy="360" r="44" />
            <g transform="translate(490,360) scale(1.4)"><use href="#icon-lightning" class="svg-icon"/></g>
            <text class="network-label" x="490" y="422">edge-case-gen</text>

            <!-- Validation (center-right of circle) -->
            <circle class="network-node" cx="700" cy="100" r="60" />
            <g transform="translate(700,100) scale(1.8)"><use href="#icon-search" class="svg-icon"/></g>
            <text class="network-label" x="700" y="35">impl-validator</text>

            <circle class="network-node" cx="670" cy="507" r="44" />
            <g transform="translate(670,507) scale(1.4)"><use href="#icon-link" class="svg-icon"/></g>
            <text class="network-label" x="670" y="569">reference-validator</text>

            <circle class="network-node" cx="820" cy="290" r="60" />
            <g transform="translate(820,290) scale(1.8)"><use href="#icon-wrench" class="svg-icon"/></g>
            <text class="network-label" x="820" y="370">ci-fixer</text>

            <!-- Exit (right) - smaller nodes to emphasize the ellipse -->
            <circle class="network-node" cx="920" cy="290" r="32" />
            <g transform="translate(920,290) scale(1.0)"><use href="#icon-upload" class="svg-icon"/></g>
            <text class="network-label" x="920" y="338">pr-pusher</text>

            <circle class="network-node" cx="1000" cy="290" r="32" />
            <g transform="translate(1000,290) scale(1.0)"><use href="#icon-book" class="svg-icon"/></g>
            <text class="network-label" x="1000" y="338">program-</text>
            <text class="network-label" x="1000" y="352">reviewer</text>

            <circle class="network-node output" cx="1080" cy="290" r="32" />
            <g transform="translate(1080,290) scale(1.0)"><use href="#icon-document" class="svg-icon"/></g>
            <text class="network-label" x="1080" y="338">Draft PR</text>

        </svg>
    </div>
    </div>

    <script>
        function showPhase(phase) {
            // Remove active class from all boxes
            document.querySelectorAll('.phase-box').forEach(box => {
                box.classList.remove('active');
            });

            // Hide all phase details
            document.querySelectorAll('.phase-detail').forEach(detail => {
                detail.classList.remove('active');
            });

            // Add active class to clicked box
            document.querySelector(`.phase-box[data-phase="${phase}"]`).classList.add('active');

            // Show corresponding phase detail
            document.getElementById(`phase-${phase}`).classList.add('active');

            // Hide the hint
            document.querySelector('.click-hint').style.display = 'none';
        }

        function showDiagramTab(tab) {
            // Remove active class from all tabs and panels
            document.querySelectorAll('.diagram-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.diagram-panel').forEach(p => p.classList.remove('active'));

            // Add active class to selected tab and panel
            event.target.classList.add('active');
            document.getElementById('panel-' + tab).classList.add('active');
        }
    </script>
</body>
</html>
