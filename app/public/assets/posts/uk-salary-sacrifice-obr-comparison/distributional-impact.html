<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto Serif', Georgia, serif; background: #fff; }
    .toggle-container {
      display: flex;
      justify-content: center;
      margin: 16px 0 4px 0;
    }
    .toggle-group {
      display: flex;
      background: #f0f0f0;
      border-radius: 8px;
      padding: 3px;
      gap: 2px;
    }
    .toggle-btn {
      padding: 8px 20px;
      border: none;
      border-radius: 6px;
      background: transparent;
      font-family: 'Roboto Serif', Georgia, serif;
      font-size: 13px;
      font-weight: 500;
      color: #666;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .toggle-btn.active {
      background: #319795;
      color: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }
    .toggle-btn:hover:not(.active) {
      background: #e0e0e0;
      color: #333;
    }
  </style>
</head>
<body>
<div class="toggle-container">
  <div class="toggle-group">
    <button class="toggle-btn active" onclick="switchView('abs')">Absolute (£/year)</button>
    <button class="toggle-btn" onclick="switchView('pct')">Relative (%)</button>
  </div>
</div>
<div id="chart" style="width:100%;height:470px;"></div>
<script>
const deciles = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'];
const absChanges = [-2, -34, -8, -8, -9, -7, -11, -14, -33, -503];
const pctChanges = [-0.01, -0.10, -0.02, -0.02, -0.02, -0.01, -0.02, -0.02, -0.04, -0.36];

const font = 'Roboto Serif, Georgia, serif';

function getTrace(data, fmt) {
  return {
    x: deciles,
    y: data,
    type: 'bar',
    marker: { color: '#616161', cornerradius: 2 },
    text: data.map(v => fmt(v)),
    textposition: 'outside',
    textfont: { family: font, size: 11, color: '#444' },
    hovertemplate: fmt === fmtAbs
      ? 'Decile %{x}<br>%{y:,.0f} per year<extra></extra>'
      : 'Decile %{x}<br>%{y:.2f}%<extra></extra>',
    hoverlabel: { font: { family: font, size: 13 }, bgcolor: '#fff', bordercolor: '#ccc' }
  };
}

const fmtAbs = v => (v < 0 ? '-£' + Math.abs(v).toLocaleString() : '£' + v.toLocaleString());
const fmtPct = v => v.toFixed(2) + '%';

const baseLayout = {
  xaxis: {
    title: { text: 'Income decile', font: { family: font, size: 13, color: '#555' }, standoff: 10 },
    tickfont: { family: font, size: 12, color: '#444' },
    dtick: 1
  },
  yaxis: {
    tickfont: { family: font, size: 11, color: '#666' },
    gridcolor: '#eee',
    zeroline: true,
    zerolinewidth: 1.5,
    zerolinecolor: '#999'
  },
  margin: { t: 10, b: 55, l: 70, r: 50 },
  plot_bgcolor: '#fff',
  paper_bgcolor: '#fff',
  images: []
};

function switchView(mode) {
  document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
  if (mode === 'abs') {
    document.querySelectorAll('.toggle-btn')[0].classList.add('active');
    Plotly.react('chart', [getTrace(absChanges, fmtAbs)], {
      ...baseLayout,
      yaxis: {
        ...baseLayout.yaxis,
        title: { text: 'Average change in net income (£/year)', font: { family: font, size: 12, color: '#555' } },
        tickprefix: '£', tickformat: ',.0f'
      }
    }, {responsive: true, displayModeBar: false});
  } else {
    document.querySelectorAll('.toggle-btn')[1].classList.add('active');
    Plotly.react('chart', [getTrace(pctChanges, fmtPct)], {
      ...baseLayout,
      yaxis: {
        ...baseLayout.yaxis,
        title: { text: 'Average % change in net income', font: { family: font, size: 12, color: '#555' } },
        ticksuffix: '%', tickformat: '.2f'
      }
    }, {responsive: true, displayModeBar: false});
  }
}

switchView('abs');
</script>
</body>
</html>
